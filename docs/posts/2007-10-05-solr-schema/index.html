<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solr Schema</title>
    <meta name="description" content="I write about my experiences...randomly">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Wayne Graham&#39;s Musings">
	<link rel="alternate" href="/feed.json" type="application/json" title="Wayne Graham&#39;s Musings">
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
    <a href="#skip" class="visually-hidden">Skip to main content</a>

    <header>
    <a href="/" class="home-link">Wayne Graham&#39;s Musings</a>
    <nav>
        <h2 class="visually-hidden">Top level navigation menu</h2>
        <ul class="nav">
            <li class="nav-item"><a href="/">Home</a></li>
            <li class="nav-item"><a href="/blog/">Archive</a></li>
        </ul>
    </nav>
</header>
    <main id="skip">
        
<h1>Solr Schema</h1>

<ul class="post-metadata">
    <li><time datetime="2007-10-05">05 October 2007</time></li>
</ul>

<p>If you've ever worked on a project that involved Coldfusion's bundled version of Verity, you've no doubt run into the issue of trying to confine your fields into the structure that Verity imposes, and those custom fields are really precious in these instances. About 6 months ago, I ran into an issue with a search project where I had about 125,000 documents to index. Since we also wanted to be able to use the indexes for some other projects, I was a bit nervous to commit almost the entire allotment of indexable objects to one collection. This launched me into writing a custom search engine and indexer using Lucene and slapping Coldfusion around the responses to do things that Verity did. However, once the projects were complete, I never really got around to making it easy to use. It does cool stuff like search across multiple collections, context highlighting, relevancy calculations, term vector calculations, &quot;did you mean&quot;, etc. Essentially everything I think all good search engines need to be able to do. Something this system lacked was an easy way to define the fields that you wanted indexed (along with a knowledge of Java to actually make the changes).</p>
<p>The ability to create any number of fields to index in different ways (along with faceting) is a real strong point of Solr. Not only can you add fields and choose how that data is analyzed, you can create your own field types that process the information in your index the way you want them to be.</p>
<p>This is done in the <code>$SOLR_HOME/config/schema.xml</code> file. The first section (<types>) defines the types of fields that you will be using, and how Solr should process them with Lucene. If you look at some of the fieldtypes, you'll get an idea of what's possible. For instance, the fieldtype for &quot;string&quot; is an untokenized field that doesn't normalize the fields and sorts missing information last.</p>
<pre class="language-xml" tabindex="0"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldtype</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>solr.StrField<span class="token punctuation">"</span></span> <span class="token attr-name">sortMissingLast</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">omitNorms</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
</code></pre>
<p>However, if you need a more robust fieldtype, look at the fieldtype for &quot;text&quot;. This uses a whitespace tokenizer (splits words with whitespace) and uses the stopwords defined in the stopwords.txt file. It does some other processing (filters words, converts them to lowercase, runs a porter stemmer, and then removes duplicates). This fieldtype also defines what to do when a query is passed to it (uses the same filters). This is slightly different than the defined &quot;textTight&quot; which does not perform any further analysis on the text when being queried. You'll probably find that most of these work for most instances, but if you need to, you can build your own fieldtype that has very specific indexing and query filters.</p>
<p>The next section contains the actual fields you want to use in the aptly named &quot;fields&quot; element. This is where you actually define the fields that will be in your index, the type of analysis to perform on the field, if it should be indexed, stored, have term vectors, or be multivalued (have multiple instances of the same field in the index).</p>
<p>Let's say you're wanting to develop an indexing schema for books (hey, I work in a library). At a very basic level, you'd want a field for an id, title, author, reviews, and a set of topics (or tags). Your fields element would contain something along the lines of:</p>
<pre class="language-xml" tabindex="0"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“id”</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“string”</span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”</span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”/</span><span class="token punctuation">></span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“title”</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“text”</span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”</span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”</span> <span class="token attr-name">termVectors</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”</span> <span class="token punctuation">/></span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“titleStr”</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“string”</span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”</span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“false”</span> <span class="token attr-name">multiValued</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”/</span><span class="token punctuation">></span></span> 
&lt;field name=“author” type=“text” indexed=“true” stored=“true”termVectors=“true” /> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“authorStr”</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“string”</span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”</span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“false”</span> <span class="token attr-name">multiValued</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”/</span><span class="token punctuation">></span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“review”</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“text”</span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”</span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”</span> <span class="token attr-name">multiValued</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”/</span><span class="token punctuation">></span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“topic”</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“text”</span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”</span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”</span> <span class="token attr-name">multiValued</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”</span> <span class="token attr-name">termVectors</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”/</span><span class="token punctuation">></span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“topicStr”</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“string”</span> <span class="token attr-name">indexed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”</span> <span class="token attr-name">stored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“false”</span> <span class="token attr-name">multiValued</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“true”/</span><span class="token punctuation">></span></span></code></pre>
<p>You'll notice that I have a couple of extra fields for title, author, and topic, these are for the faceting info and are just untokenized fields to make the calculations for facets a little more efficient.</p>
<p>Now, we're almost done with creating the schema. We just need to declare a unique key, default search field, and default search operator.</p>
<pre class="language-xml" tabindex="0"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uniqueKey</span><span class="token punctuation">></span></span>id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>uniqueKey</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defaultSearchField</span><span class="token punctuation">></span></span>title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>defaultSearchField</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>solrQueryParser</span> <span class="token attr-name">defaultOperator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>OR<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre>
<p>Remember when I made the fields with the &quot;Str&quot; suffix? We can use a really cool feature of Solr called a &quot;copyField&quot; that literally copies the information from one field to another.</p>
<pre class="language-xml" tabindex="0"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>copyField</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“author”</span> <span class="token attr-name">dest</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“authorStr”/</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>copyField</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“title”</span> <span class="token attr-name">dest</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“titleStr”/</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>copyField</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“topic”</span> <span class="token attr-name">dest</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>“topicStr”/</span><span class="token punctuation">></span></span></code></pre>
<p>It's worth mentioning here that Solr indexes are not databases! While there are some similarities in the way that Solr allows you to add, update, select, store, and delete information from the index, Solr isn't an RDBMS. I've seen a few discussions where there is some confusion as to why Solr can't do the equivalent of a stored procedure, or some other function of a database.</p>
<p>Now, your index server is ready to receive documents to search against. The server, in with the above example as the schema, will expect information to be in the following format:</p>
<pre class="language-xml" tabindex="0"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Solr Rocks!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Barr, Foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>review<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>This book rocks!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>review<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>This book is horrible!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>topic<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>information retrieval systems<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>topic<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>xml <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>topic<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>search<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>topic<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>apache foundation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">></span></span></code></pre>
<p>Next week when I get some time, I'll write about creating facet queries...</p>

<ul class="links-nextprev"><li>Previous: <a href="/posts/2007-10-05-solr-and-coldfusion-setting-up/">Solr and Coldfusion -- Setting Up</a></li><li>Next: <a href="/posts/2007-10-31-solcoldfusion-update/">SolColdfusion Update</a></li>
</ul>
    </main>
</body>
<footer></footer>
<!-- Current page: /posts/2007-10-05-solr-schema/ -->
</html>