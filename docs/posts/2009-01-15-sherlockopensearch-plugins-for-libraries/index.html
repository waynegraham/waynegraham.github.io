<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sherlock/OpenSearch Plugins for Libraries</title>
    <meta name="description" content="I write about my experiences...randomly">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Wayne Graham&#39;s Musings">
	<link rel="alternate" href="/feed.json" type="application/json" title="Wayne Graham&#39;s Musings">
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
    <a href="#skip" class="visually-hidden">Skip to main content</a>

    <header>
    <a href="/" class="home-link">Wayne Graham&#39;s Musings</a>
    <nav>
        <h2 class="visually-hidden">Top level navigation menu</h2>
        <ul class="nav">
            <li class="nav-item"><a href="/">Home</a></li>
            <li class="nav-item"><a href="/blog/">Archive</a></li>
        </ul>
    </nav>
</header>
    <main id="skip">
        <h1>Sherlock/OpenSearch Plugins for Libraries</h1>

<ul class="post-metadata">
    <li><time datetime="2009-01-15">15 January 2009</time></li>
</ul>

<p>Back in the day, I used to work on the <a href="http://mycroft.mozdev.org/">Mycroft Project</a>. At the time, only Firefox/Netscape could actually used these plugins as they were based on Apple's Sherlock specification (Mycroft is Sherlock Holmes' brother, btw). These plugins have been a staple in the Firefox browser, but the Sherlock spec was a little arcane. More recently, both Firefox and IE have implemented support for the <a href="http://www.opensearch.org/Home">OpenSearch specification</a>. I have to say that the OpenSearchDescription is a significant update (at least from a readability standpoint) than Sherlock.</p>
<p>A few years ago, I had written a bunch of Sherlock plugins for <a href="http://swem.wm.edu/resources/tools/">searching various library</a> catalogs. Those pretty much lay dormant until I was talking with my student worker this last semester and he got quite excited about these, and wondered if there might be a way to also search the databases the library subscribes to, and provide off-campus access to these through our proxy server. This code is in a very basic stage right now, but essentially what I did was create a database driven application in PHP that generates OpenSearch XML for various targets to search against.</p>
<p>Right now, this only supports HTTP GET requests (POST parameters require an additional table), but here's the DDL:</p>
<pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>plugins<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>short_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>description<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>engine<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>image<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>input_encoding<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>url<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">550</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>method<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">default</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>proxy<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">default</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>engine_index<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>engine<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>short_name_index<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>short_name<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>latin1</code></pre>
<p>You don't need all of these fields for every record, and here is some useful records...</p>
<pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> plugins <span class="token punctuation">(</span>id<span class="token punctuation">,</span> short_name<span class="token punctuation">,</span> <span class="token keyword">engine</span><span class="token punctuation">,</span> input_encoding<span class="token punctuation">,</span> method<span class="token punctuation">,</span> proxy<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>UUID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' JStor'</span><span class="token punctuation">,</span> <span class="token string">'jstor'</span><span class="token punctuation">,</span> <span class="token string">'UTF-8'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'http://www.jstor.org/action/doBasicSearch?Query='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> plugins <span class="token punctuation">(</span>id<span class="token punctuation">,</span> short_name<span class="token punctuation">,</span> <span class="token keyword">engine</span><span class="token punctuation">,</span> input_encoding<span class="token punctuation">,</span> method<span class="token punctuation">,</span> proxy<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>UUID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Google Your University'</span><span class="token punctuation">,</span> <span class="token string">'google'</span><span class="token punctuation">,</span> <span class="token string">'UTF-8'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'http://www.google.com/univ/wm?hl=en&amp;amp;ie=ISO-8859-1&amp;amp;btnG=Google+Search&amp;amp;q='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> plugins <span class="token punctuation">(</span>id<span class="token punctuation">,</span> short_name<span class="token punctuation">,</span> <span class="token keyword">engine</span><span class="token punctuation">,</span> input_encoding<span class="token punctuation">,</span> method<span class="token punctuation">,</span> proxy<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>UUID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Google Scholar'</span><span class="token punctuation">,</span> <span class="token string">'googlescholar'</span><span class="token punctuation">,</span> <span class="token string">'UTF-8'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'http://scholar.google.com/scholar?&amp;amp;hl=en&amp;amp;lr=&amp;amp;btnG=Search&amp;amp;q='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> plugins <span class="token punctuation">(</span>id<span class="token punctuation">,</span> short_name<span class="token punctuation">,</span> <span class="token keyword">engine</span><span class="token punctuation">,</span> input_encoding<span class="token punctuation">,</span> method<span class="token punctuation">,</span> proxy<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>UUID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Ebrary'</span><span class="token punctuation">,</span> <span class="token string">'ebrary'</span><span class="token punctuation">,</span> <span class="token string">'UTF-8'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'http://site.ebrary.com/lib//Top?layout=search&amp;amp;nosr=1&amp;amp;sch=sch&amp;amp;frm=smp.x&amp;amp;p00='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> plugins <span class="token punctuation">(</span>id<span class="token punctuation">,</span> short_name<span class="token punctuation">,</span> <span class="token keyword">engine</span><span class="token punctuation">,</span> input_encoding<span class="token punctuation">,</span> method<span class="token punctuation">,</span> proxy<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>UUID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'EbscoHost'</span><span class="token punctuation">,</span> <span class="token string">'ebsco'</span><span class="token punctuation">,</span> <span class="token string">'UTF-8'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'http://search.ebscohost.com/login.aspx?db=aph&amp;amp;direct=true&amp;amp;bQuery='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> plugins <span class="token punctuation">(</span>id<span class="token punctuation">,</span> short_name<span class="token punctuation">,</span> <span class="token keyword">engine</span><span class="token punctuation">,</span> input_encoding<span class="token punctuation">,</span> method<span class="token punctuation">,</span> proxy<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>UUID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'LexisNexis'</span><span class="token punctuation">,</span> <span class="token string">'lexisnexis'</span><span class="token punctuation">,</span> <span class="token string">'UTF-8'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'http://www.lexisnexis.com/us/lnacademic/search/homesubmitForm.do'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> plugins <span class="token punctuation">(</span>id<span class="token punctuation">,</span> short_name<span class="token punctuation">,</span> <span class="token keyword">engine</span><span class="token punctuation">,</span> input_encoding<span class="token punctuation">,</span> method<span class="token punctuation">,</span> proxy<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>UUID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Proquest UMI'</span><span class="token punctuation">,</span> <span class="token string">'umi'</span><span class="token punctuation">,</span> <span class="token string">'UTF-8'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'http://proquest.umi.com/pqdweb?RQT=305&amp;amp;FT=1&amp;amp;DBId=414&amp;amp;SQ='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> plugins <span class="token punctuation">(</span>id<span class="token punctuation">,</span> short_name<span class="token punctuation">,</span> <span class="token keyword">engine</span><span class="token punctuation">,</span> input_encoding<span class="token punctuation">,</span> method<span class="token punctuation">,</span> proxy<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>UUID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Science Direct'</span><span class="token punctuation">,</span> <span class="token string">'sciencedirect'</span><span class="token punctuation">,</span> <span class="token string">'UTF-8'</span><span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'http://www.sciencedirect.com/science/quicksearch?query='</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Apparently I wrote the queries with MDB2, I've since moved most of my interactions to Zend Db (you should be able to write that part pretty quickly) and just dump the names of the plugins in the tableon a view:</p>
<pre class="language-php" tabindex="0"><code class="language-php"><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$plugins</span> <span class="token keyword">as</span> <span class="token variable">$plugin</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;li>'</span> <span class="token operator">.</span> <span class="token variable">$plugin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'short_name'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">': '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' &lt;a href="openSearch.php?id='</span> <span class="token operator">.</span> <span class="token variable">$plugin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'">&lt;img src="images/a9.png" title="OpenSearch" />&lt;/a>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$plugin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' &lt;a href="search.php?engine='</span> <span class="token operator">.</span> <span class="token variable">$plugin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'engine'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&amp;amp;q=regulators">test search'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">' | &lt;a href="#" title="Ref: '</span> <span class="token operator">.</span> <span class="token variable">$plugin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'engine'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'" onClick="addOpenSearch(\''</span> <span class="token operator">.</span> <span class="token variable">$plugin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'engine'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'\', \'gif\', \'Education\', \''</span> <span class="token operator">.</span> <span class="token variable">$plugin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'\'); return false;">add&lt;/a>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;/li>);

'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">endforeach</span><span class="token punctuation">;</span></code></pre>
<p>The add code is straight-forward</p>
<pre class="language-php" tabindex="0"><code class="language-php">$result = $result[0];

$short_name = $result['short_name'];
$description = $result['description'];
$engine = $result['engine'];
$id = $result['id']; 

$xml = &lt;&lt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EOT</span>
<span class="token attr-name"><span class="token php language-php"><span class="token delimiter important">&lt;?</span>xml version<span class="token operator">=</span><span class="token string double-quoted-string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string double-quoted-string">"UTF-8"</span><span class="token delimiter important">?></span></span></span>
<span class="token attr-name">&lt;OpenSearchDescription</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://a9.com/-/spec/opensearch/1.1/<span class="token punctuation">"</span></span> 
    <span class="token attr-name"><span class="token namespace">xmlns:</span>moz</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.mozilla.org/2006/browser/search/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ShortName</span><span class="token punctuation">></span></span>$short_name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ShortName</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Description</span><span class="token punctuation">></span></span>$description<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Description</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Url</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/html<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span> <span class="token attr-name">template</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://&lt;your_server>/plugins/proxy.php?engine=$engine<span class="token entity named-entity" title="&amp;">&amp;amp;</span>q=<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Contact</span><span class="token punctuation">></span></span>libsys@wm.edu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Contact</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Image</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>http://<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>your_server</span><span class="token punctuation">></span></span>/favicon.ico<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Image</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Developer</span><span class="token punctuation">></span></span>Wayne Graham<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Developer</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>InputEncoding</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>InputEncoding</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">moz:</span>SearchForm</span><span class="token punctuation">></span></span>http://<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>your_server</span><span class="token punctuation">></span></span>/plugins/search.php?engine=$engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">moz:</span>SearchForm</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">moz:</span>UpdateUrl</span><span class="token punctuation">></span></span>http://<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>your_server</span><span class="token punctuation">></span></span>/plugins/opensearch.php?$id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">moz:</span>UpdateUrl</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">moz:</span>IconUpdateUrl</span><span class="token punctuation">></span></span>http://swem.wm.edu/favicon.ico<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">moz:</span>IconUpdateUrl</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">moz:</span>UpdateInterval</span><span class="token punctuation">></span></span>7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">moz:</span>UpdateInterval</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>OpenSearchDescription</span><span class="token punctuation">></span></span>
EOT;
header("Content-Type: text/xml");
echo($xml);</code></pre>
<p>You just need a little JavaScript to add this in to IE and Firefox:</p>
<pre class="language-javascript" tabindex="0"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">addOpenSearch</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>ext<span class="token punctuation">,</span>cat<span class="token punctuation">,</span>pid<span class="token punctuation">,</span>meth</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> window<span class="token punctuation">.</span>external <span class="token operator">==</span> <span class="token string">"object"</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">038</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">038</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> window<span class="token punctuation">.</span>external<span class="token punctuation">.</span>AddSearchProvider <span class="token operator">==</span> <span class="token string">"unknown"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window<span class="token punctuation">.</span>external<span class="token punctuation">.</span>AddSearchProvider <span class="token operator">==</span> <span class="token string">"function"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// See bugs 430058/430067/430070 for Camino</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> window<span class="token punctuation">.</span>external<span class="token punctuation">.</span>AddSearchProvider <span class="token operator">==</span> <span class="token string">"unknown"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>vendor <span class="token operator">==</span> <span class="token string">'Camino'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">038</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">038</span><span class="token punctuation">;</span> meth <span class="token operator">==</span> <span class="token string">"p"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"This plugin uses POST which is not currently supported by your browser's implementation of OpenSearch."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span>external<span class="token punctuation">.</span><span class="token function">AddSearchProvider</span><span class="token punctuation">(</span><span class="token string">"http://&lt;your_server>/plugins/install.php?id="</span> <span class="token operator">+</span> pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"You will need a browser which supports OpenSearch to install this plugin."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>If I get some time soon, I'll wrap this up into a package; rudimentary, but a decent start to your own app!</p>

<ul class="links-nextprev"><li>Previous: <a href="/posts/2009-01-15-library-search-google-gadget/">Library Search Google Gadget</a></li><li>Next: <a href="/posts/2009-01-16-rdesktop-and-tcltk/">rdesktop and Tcl/tk</a></li>
</ul>
    </main>
</body>
<footer></footer>
<!-- Current page: /posts/2009-01-15-sherlockopensearch-plugins-for-libraries/ -->
</html>